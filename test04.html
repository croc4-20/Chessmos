<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script type="module" src="KeplrConnect.js" defer></script>
    <script src="https://unpkg.com/@keplr-wallet/provider"></script>
    <script src="./New/main.bundle.js"></script>
    <style>
        #lightsaber 
        {
            display: none;
            position: absolute;
            height: 100%;
            z-index: 10;
            transition: left 0.5s ease-in-out; /* Smooth transition for horizontal movement */
        }

        #chessboard 
        {
            position: relative;
            display: grid;
            grid-template-columns: repeat(8, 67.2px);
            grid-template-rows: repeat(8, 67.2px);
            width: 560px;
            height: 560px;
            overflow: hidden;
            z-index: 2;
        }
        #body
        {
            background-color: lightslategrey;
            /*    background-image: url('img/background.png');*/
            background-size: cover;
/*            overflow: hidden;*/
            z-index: 2;
        }
        .rainbow-background {
    position: relative;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
/*    background: radial-gradient(circle, red, yellow, lime, aqua, blue, fuchsia, red);*/
    background-size: cover;
    animation: colorChange 30s linear infinite;
    z-index: -1;
}

@keyframes colorChange {
    0.0% { background-color: #ff0000; }
    0.67% { background-color: #ff0a00; }
    1.33% { background-color: #ff1400; }
    2.0% { background-color: #ff1e00; }
    2.67% { background-color: #ff2800; }
    3.33% { background-color: #ff3200; }
    4.0% { background-color: #ff3d00; }
    4.67% { background-color: #ff4700; }
    5.33% { background-color: #ff5100; }
    6.0% { background-color: #ff5b00; }
    6.67% { background-color: #ff6600; }
    7.33% { background-color: #ff7000; }
    8.0% { background-color: #ff7a00; }
    8.67% { background-color: #ff8400; }
    9.33% { background-color: #ff8e00; }
    10.0% { background-color: #ff9900; }
    10.67% { background-color: #ffa300; }
    11.33% { background-color: #ffad00; }
    12.0% { background-color: #ffb700; }
    12.67% { background-color: #ffc100; }
    13.33% { background-color: #ffcc00; }
    14.0% { background-color: #ffd600; }
    14.67% { background-color: #ffe000; }
    15.33% { background-color: #ffea00; }
    16.0% { background-color: #fff400; }
    16.67% { background-color: #ffff00; }
    17.33% { background-color: #f4ff00; }
    18.0% { background-color: #eaff00; }
    18.67% { background-color: #e0ff00; }
    19.33% { background-color: #d6ff00; }
    20.0% { background-color: #cbff00; }
    20.67% { background-color: #c1ff00; }
    21.33% { background-color: #b7ff00; }
    22.0% { background-color: #adff00; }
    22.67% { background-color: #a3ff00; }
    23.33% { background-color: #99ff00; }
    24.0% { background-color: #8eff00; }
    24.67% { background-color: #84ff00; }
    25.33% { background-color: #7aff00; }
    26.0% { background-color: #70ff00; }
    26.67% { background-color: #65ff00; }
    27.33% { background-color: #5bff00; }
    28.0% { background-color: #51ff00; }
    28.67% { background-color: #47ff00; }
    29.33% { background-color: #3dff00; }
    30.0% { background-color: #33ff00; }
    30.67% { background-color: #28ff00; }
    31.33% { background-color: #1eff00; }
    32.0% { background-color: #14ff00; }
    32.67% { background-color: #0aff00; }
    33.33% { background-color: #00ff00; }
    34.0% { background-color: #00ff0a; }
    34.67% { background-color: #00ff14; }
    35.33% { background-color: #00ff1e; }
    36.0% { background-color: #00ff28; }
    36.67% { background-color: #00ff32; }
    37.33% { background-color: #00ff3d; }
    38.0% { background-color: #00ff47; }
    38.67% { background-color: #00ff51; }
    39.33% { background-color: #00ff5b; }
    40.0% { background-color: #00ff66; }
    40.67% { background-color: #00ff70; }
    41.33% { background-color: #00ff7a; }
    42.0% { background-color: #00ff84; }
    42.67% { background-color: #00ff8e; }
    43.33% { background-color: #00ff99; }
    44.0% { background-color: #00ffa3; }
    44.67% { background-color: #00ffad; }
    45.33% { background-color: #00ffb7; }
    46.0% { background-color: #00ffc1; }
    46.67% { background-color: #00ffcb; }
    47.33% { background-color: #00ffd6; }
    48.0% { background-color: #00ffe0; }
    48.67% { background-color: #00ffea; }
    49.33% { background-color: #00fff4; }
    50.0% { background-color: #00ffff; } /* cyan */
    50.67% { background-color: #00f4ff; }
    51.33% { background-color: #00eaff; }
    52.0% { background-color: #00e0ff; }
    52.67% { background-color: #00d6ff; }
    53.33% { background-color: #00cbff; }
    54.0% { background-color: #00c1ff; }
    54.67% { background-color: #00b7ff; }
    55.33% { background-color: #00adff; }
    56.0% { background-color: #00a3ff; }
    56.67% { background-color: #0099ff; }
    57.33% { background-color: #008eff; }
    58.0% { background-color: #0084ff; }
    58.67% { background-color: #007aff; }
    59.33% { background-color: #0070ff; }
    60.0% { background-color: #0066ff; }
    60.67% { background-color: #005bff; }
    61.33% { background-color: #0051ff; }
    62.0% { background-color: #0047ff; }
    62.67% { background-color: #003dff; }
    63.33% { background-color: #0033ff; }
    64.0% { background-color: #0028ff; }
    64.67% { background-color: #001eff; }
    65.33% { background-color: #0014ff; }
    66.0% { background-color: #000aff; }
    66.67% { background-color: #0000ff; } /* blue */
    67.33% { background-color: #0a00ff; }
    68.0% { background-color: #1400ff; }
    68.67% { background-color: #1e00ff; }
    69.33% { background-color: #2800ff; }
    70.0% { background-color: #3200ff; }
    70.67% { background-color: #3d00ff; }
    71.33% { background-color: #4700ff; }
    72.0% { background-color: #5100ff; }
    72.67% { background-color: #5b00ff; }
    73.33% { background-color: #6500ff; }
    74.0% { background-color: #7000ff; }
    74.67% { background-color: #7a00ff; }
    75.33% { background-color: #8400ff; }
    76.0% { background-color: #8e00ff; }
    76.67% { background-color: #9900ff; }
    77.33% { background-color: #a300ff; }
    78.0% { background-color: #ad00ff; }
    78.67% { background-color: #b700ff; }
    79.33% { background-color: #c100ff; }
    80.0% { background-color: #cc00ff; }
    80.67% { background-color: #d600ff; }
    81.33% { background-color: #e000ff; }
    82.0% { background-color: #ea00ff; }
    82.67% { background-color: #f400ff; }
    83.33% { background-color: #ff00ff; } /* magenta */
    84.0% { background-color: #ff00f4; }
    84.67% { background-color: #ff00ea; }
    85.33% { background-color: #ff00e0; }
    86.0% { background-color: #ff00d6; }
    86.67% { background-color: #ff00cb; }
    87.33% { background-color: #ff00c1; }
    88.0% { background-color: #ff00b7; }
    88.67% { background-color: #ff00ad; }
    89.33% { background-color: #ff00a3; }
    90.0% { background-color: #ff0098; }
    90.67% { background-color: #ff008e; }
    91.33% { background-color: #ff0084; }
    92.0% { background-color: #ff007a; }
    92.67% { background-color: #ff0070; }
    93.33% { background-color: #ff0066; }
    94.0% { background-color: #ff005b; }
    94.67% { background-color: #ff0051; }
    95.33% { background-color: #ff0047; }
    96.0% { background-color: #ff003d; }
    96.67% { background-color: #ff0033; }
    97.33% { background-color: #ff0028; }
    98.0% { background-color: #ff001e; }
    98.67% { background-color: #ff0014; }
    99.33% { background-color: #ff000a; }
    100% { background-color: #FF0000; } 
}
        
.background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    z-index: -1;
}

.particle {
    position: absolute;
    width: var(--size);
    height: var(--size);
    background-color: rgba(255, 255, 255, var(--opacity));
    border-radius: 50%;
    animation: float var(--duration) linear infinite;
}

/* Different keyframes for variety in movement */
@keyframes float {
    0%, 100% { transform: translate(0, 0); }
    25% { transform: translate(calc(-1 * var(--distance)), calc(-1 * var(--distance))); }
    50% { transform: translate(var(--distance), var(--distance)); }
    75% { transform: translate(calc(-1 * var(--distance) / 2), var(--distance)); }
}

.background:hover .particle {
    animation-duration: calc(var(--duration) / 2); /* Speeds up the animation */
}

#spell-buttons {
    position: relative;
  display: flex;
  justify-content: space-around;
  margin: 20px;
  z-index: 2;
}
/*CSS TIMER*/
.turn-timer-display {
    font-size: 20px;
    font-weight: bold;
    color: #fff;
    background-color: #444;
    padding: 10px;
    border-radius: 5px;
    text-align: center;
    width: 200px;
    margin: 10px auto;
}

.extra-timer-display {
    font-size: 20px;
    font-weight: bold;
    color: #fff;
    background-color: #555; /* Slightly different shade for distinction */
    padding: 10px;
    border-radius: 5px;
    text-align: center;
    width: 200px;
    margin: 10px auto;
}

.turn-count-display {
    font-size: 20px;
    font-weight: bold;
    color: #fff;
    background-color: #666; /* Another shade for distinction */
    padding: 10px;
    border-radius: 5px;
    text-align: center;
    width: 200px;
    margin: 10px auto;
}
@keyframes blink {
    0% { background-color: #444; }
    50% { background-color: red; }
    100% { background-color: #444; }
}

.blinking {
    animation: blink 1s linear infinite;
}
/*CSS TIMER*/
.chess-square.highlight {
  border: 2px solid green; /* Example highlight style */
}
/*asking user to click on square css*/
.modal {
  display: none;
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.4);
}

.modal-content {
  background-color: #fefefe;
  margin: 15% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
}

.close-button {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close-button:hover,
.close-button:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

.spell-button {
  padding: 20px;
  font-size: 1.5em;
  color: white;
  border-radius: 10px;
  text-align: center;
  cursor: pointer;
  transition: transform 0.2s;
  border: 2px solid #fff;
  background-color: #444;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  width: 150px; /* Adjust the width as needed */
  height: 150px; /* Adjust the height as needed */
}

.spell-button svg {
    
    margin: auto;
    width: 100%;
    height: auto; 
    transform: translate(100px);
    align-self: stretch;
    display: block;
}


.spell-button .tooltiptext {
  visibility: hidden;
  width: 200px;
  background-color: black;
  color: white;
  text-align: center;
  border-radius: 6px;
  padding: 5px 0;
  position: absolute;
  z-index: 1;
  bottom: 150%;
  left: 50%;
  margin-left: -100px;
  opacity: 0;
  transition: opacity 0.5s;
  font-size: 14px;
}

.spell-button:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
}


#defensive-spell-button {
  background-color: #4CAF50; /* Green */
}

#offensive-spell-button {
  background-color: #f44336; /* Red */
}

.spell-button:hover {
  transform: scale(1.1);
}

.light
{
    background-color: lightskyblue;
}

.dark
{
    background-color: SteelBlue;   
}

/*.pattern {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 20px;
  height: 20px;
  border-radius: 100%;
  background-color: white;
  box-shadow: 50 0 50 1px black;
  background-color: thistle;
}*/
.canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1; /* Ensures the canvas stays behind all other content */
}

.pattern {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 100px;
  height: 100px;
  background-image: url('img/WizardHat.png');
  background-size: cover;
}
.selected-piece
{
  background-color: thistle;
}
.highlight 
{
  background-color: lightsalmon;
  border: 2px solid blue;
}
.chess-square
{
   border: 0.05px solid black;
   position : relative;
   align-items: center;
   display: flex;
   justify-content: center;

}

.chess-piece
{
    
    background-size: cover;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    position: absolute;
    z-index: 1;
    overflow: hidden;

}

.white-pawn
{
    width: 66.2px;
    height: 66.2px;
   background-size: cover;
   position: relative;
   top: 0;
   left: 0;
   bottom: 0;
   right: 0;

    
}
.black-knight
{
    
    width: 66.2px;
    height: 66.2px;
    background-image: url('img/blackBISHOP.png');
    background-size: cover;
    
   

}
.white-knight
{
    width: 67.2px;
    height: 67.2px;
    background-size: cover;
    background-position: center;
}

.black-pawn
{
    
    width: 66.2px;
    height: 66.2px;
    background-size: cover;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    position: absolute;
    z-index: 1;
    overflow: hidden;
}
.white-king
{
    
    background-size: cover;
    width: 66.2px;
    height: 66.2px;
}
.black-king
{
    width: 66.2px;
    height: 66.2px;
    background-size: cover;
    position: absolute;
    
}
.black-queen
{
    background-image: url('testNewImages/BlackQUeenRevisited.png');
    width: 66.2px;
    height: 66.2px;
    background-size: cover;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    position: absolute;
}
.white-queen
{
    background-image: url('images/whiteQUEEN.png');
    background-size: cover;
    width: 66.2px;
    height: 66.2px;
}
.black-rook
{
    background-image: url('img/BlackROOK.png');
    background-size: cover;
    width: 67.2px;
    height: 67.2px;
}
.white-rook
{
    background-image: url('images/WhiteROOK.png');
    background-size: cover;
    width: 67.2px;
    height: 67.2px;
}
.white-bishop
{
    background-image: url('img/whiteBISHOP.png');
    background-size: cover;
     width: 67.2px;
    height: 67.2px;
    
}
.black-bishop
{
    background-image: url('images/blackBishop.png');
   width: 67.2px;
    height: 67.2px;
}

/* Style for frozen squares */
.frozen-square {
    background-color: rgba(173, 216, 230, 0.5); /* Light blue with some transparency */
    border: 2px solid rgba(0, 191, 255, 0.7); /* Brighter blue border for a frosty look */
    box-shadow: 0 0 10px rgba(0, 191, 255, 0.5); /* Soft glow to enhance the icy effect */
}

/* Style for frozen pieces */
.frozen-piece {
    filter: brightness(80%) saturate(0%) contrast(120%); /* Adjusts the color to give a cold feel */
    opacity: 0.8; /* Adjust opacity to indicate frozen state */
    transform: scale(1.05); /* Slightly enlarge the piece to suggest it's encased in ice */
    box-shadow: 0 0 15px rgba(0, 191, 255, 0.8); /* Add a glowing ice effect */
    transition: all 0.3s ease; /* Smooth transition for when the piece gets frozen/unfrozen */
}
.dagger {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    /* Adjust size as needed */
    width: 20px;
    height: 20px;
    z-index: 10;
}
.rift {
    background-image: radial-gradient(circle, rgba(255, 0, 0, 0.8) 10%, rgba(0, 0, 0, 0.8) 40%, transparent 60%);
    background-size: cover;
    color: white;
    animation: riftPulse 2s infinite;
    border-radius: 5px;
    box-shadow: 0 0 8px rgba(255, 0, 0, 0.7);
}

@keyframes riftPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.notification-box {
    position: absolute;
    top: 10px; /* Adjust as needed */
    right: 10px; /* Adjust as needed */
    padding: 10px;
    background-color: #fff;
    border: 1px solid #ddd;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    z-index: 1000;
}

.notification-box img {
    width: 50px; /* Adjust as needed */
    height: auto;
}

.game-ui{
    position: center-left;
}

.pawn-container {
    position: relative; /* Keeps the number box positioned relative to the pawn */
    display: inline-block; /* Ensures layout doesn't shift */
    /* Other styles as needed */
}

.number-box {
    position: absolute;
    transform: translateX(-50%); /* Adjust for centering */
    width: 40px; /* Fixed width */
    height: 40px; /* Fixed height */
    background-color: white;
    border: 1px solid black;
    padding: 5px;
    font-size: 14px;
    font-weight: bold; /* Bold text */
    text-align: center; /* Center the text */
    color: white; /* Default text color, will be adjusted by JS */
    box-sizing: border-box; /* Prevent size changes when border or padding is adjusted */
}

/* Positioning for top and bottom rows */
.top-box {
    top: -40px; /* Height of the box */
}

.bottom-box {
    bottom: -40px; /* Height of the box */
}

.kings-number-display {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2em;
    color: #007bff; // Example color, adjust as needed
    opacity: 1;
    transition: opacity 2s; // Fade-out effect
    z-index: 1000; // Ensure it's above other elements
    /* Add more styling as per your design preference */
}


/* BEGIN OF ENCHANTED CARD SPELL  */
.spell-popup {
    position: fixed;
    right: 10px; /* Adjust as needed */
    top: 10px; /* Adjust as needed */
    background: white;
    border: 1px solid black;
    padding: 10px;
    z-index: 100;
    display: none;
}

.spell-popup.hidden {
    display: none;
}

.spell-popup.visible {
    display: block;
    animation: fadeIn 0.5s;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
.enchanted-ground {
    position: relative;
    box-shadow: 0 0 10px 2px rgba(0, 150, 255, 0.7); /* Blue glow */
    animation: pulse 2s infinite;
}

.enchanted-ground::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: url('path/to/sparkle.png'); /* Path to a sparkle image */
    opacity: 0.7;
    animation: sparkle 1.5s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

@keyframes sparkle {
    0% { background-position: 0 0; }
    50% { background-position: 100% 100%; }
    100% { background-position: 0 0; }
}
#card-container {
    display: flex;
    justify-content: center;
    margin-bottom: 10px;
}

.card {
    width: 50px; /* Adjust size as needed */
    height: 70px; /* Adjust size as needed */
    background: url('img/card.png'); /* Adjust path as needed */
    animation: shuffle 1s infinite;
}

@keyframes shuffle {
    0% { transform: rotateY(0); }
    50% { transform: rotateY(180deg); }
    100% { transform: rotateY(0); }
}
/* END OF ENCHANTED CARD SPELL  */

.dice-container {
    /* Style as needed */
    width: 50px; /* Adjust size as needed */
    height: 70px;
    display: none; /* Initially hidden */

}
/*FINAL STAND SPELL*/


.mini-board-highlight {
    border: 2px solid #f0e68c; /* Example: a gold border */
    background-color: rgba(255, 215, 0, 0.3); /* Light yellow background */
}

.inactive-square {
    filter: blur(2px); /* Slight blur effect */
    pointer-events: none; /* Disable mouse interactions */
}


/*END OF FINAL STAND SPELL*/

</style>
</head>

<body id="body">
    <div id='background'></div>
    
<!-- END OF BCKGROUND CANVAS EFFECT --> 


    <!-- NFT FETCHING -->
    <script>
       // Function to create and display iframes for each NFT
function displayNfts(nfts, chessGame) 
{
    // console.log("chessGame in displayNfts function :", chessGame);
  const container = document.getElementById('nfts-container');
  container.innerHTML = '';
  container.style.display = 'flex'; // Use flexbox to layout children horizontally
  container.style.flexWrap = 'wrap'; // Allow items to wrap as needed
  container.style.gap = '10px'; // Add gap between items for better spacing
  // console.log("gameStarted", gameStarted);
  nfts.forEach(nft => 
  {
    const nftBox = document.createElement('div');
    nftBox.classList.add('nft-box');
    nftBox.style = 'min-width: 15%; position: relative;'; // Ensure minimum width and use relative positioning

    const iframe = document.createElement('iframe');
    iframe.classList.add('nft-iframe');
    iframe.allow = 'accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture';
    iframe.allowFullscreen = true;
    iframe.style = 'width: 100%; height: 100%; border: none;';
    iframe.src = nft.media.url;
    iframe.title = nft.name;
    iframe.style.pointerEvents = 'none';


    nftBox.appendChild(iframe);
    // Add a single click event listener to the container for event delegation
    nftBox.addEventListener('click', async function(event)
    {
    //     if (gameStarted) {
    //     console.log("Game has started, changing spells is disabled.");
    //     return; // Exit the function early
    // }

    console.log('Clicked element:', event.target);
        const name = nft.name;
        const tokenId = nft.tokenId;
        console.log(`NFT clicked: ${name} with Token ID: ${tokenId}`);

        // Call fetchAndExtractClasses with the URL of the clicked NFT
        const htmlUrl = `https://ipfs-gw.stargaze-apis.com/ipfs/bafybeidwo4kicq35xnvmbaynl334uif26phmmk63sxncn76rhkyyo4ll6i/${tokenId}.html`;
        const robeClassName = await fetchAndExtractClasses(htmlUrl, 'robe');
        const staffClassName = await fetchAndExtractClasses(htmlUrl, 'staff');
        const hatClassName = await fetchAndExtractClasses(htmlUrl, 'hat');
        const beardName = await fetchAndExtractClasses(htmlUrl, 'beard')
        console.log('beardName', beardName);
        //BEARD BACKGROUND
        if (beardName === 'rainbow-beard') {
            console.log('rainbow-background activated');
            document.body.classList.add('rainbow-background');
        } else {

            console.log('You dont have a rainbox attribute');
            body.classList.remove('rainbow-background');
        }

        // Now fetch the corresponding SVG code from spellsExplain.html
        const robeSvg = await fetchSvgFromSpellsExplain('robe', robeClassName);
        const staffSvg = await fetchSvgFromSpellsExplain('staff', staffClassName);
        const hatSvg = await fetchSvgFromSpellsExplain('hat', hatClassName);

        // console.log('Robe SVG:', robeSvg);
        // console.log('Staff SVG:', staffSvg);
        // console.log('Hat SVG:', hatSvg);

        document.getElementById('robeSpell-button').innerHTML = robeSvg;
         document.getElementById('robeSpell-button').setAttribute('data-spell', robeClassName);

        document.getElementById('staffSpell-button').innerHTML = staffSvg;
         document.getElementById('staffSpell-button').setAttribute('data-spell', staffClassName);
    // const staffSpellButton = document.getElementById('staffSpell-button');
    //       if (staffSpellButton) {
    //         staffSpellButton.removeEventListener('click', chessPiece.castAdeptWandSpell); // Remove previous listener if any
    //         staffSpellButton.addEventListener('click', chessGame.castAdeptWandSpell.bind(chessGame));
    //     }

        document.getElementById('hatSpell-button').innerHTML = hatSvg;
         document.getElementById('hatSpell-button').setAttribute('data-spell', hatClassName);
         
    });

    container.appendChild(nftBox);
  });

  
}


async function fetchSvgFromSpellsExplain(traitType, className) {
    try {
        const response = await fetch('./jsFiles/spellsExplain2.html');
        const htmlText = await response.text();
        const parser = new DOMParser();
        const htmlDoc = parser.parseFromString(htmlText, 'text/html');

        // Since each trait is wrapped in a <g> element with a specific class, target that directly
        const svgContainer  = htmlDoc.querySelector(`g.${className}`);
        if (!svgContainer ) {
            console.error(`No SVG found for class ${className} and trait ${traitType}.`);
            return '';
        }
        const svgElement = svgContainer.querySelector('svg');
        return svgElement ? svgElement.outerHTML : '';
            } catch (error) {
        console.error('Error fetching SVG:', error);
        return '';
    }
}


  // This is the JavaScript code that you want to execute in the browser
  async function fetchNFTs() {
     try {
        const chainId = 'stargaze-1';
          await window.keplr.enable(chainId);

   const offlineSigner = window.getOfflineSigner(chainId);
    const accounts = await offlineSigner.getAccounts();
    console.log("Connected wallet address:", accounts[0].address);

    const query = {
      query: `
        query NFTs($ownerAddrOrName: String, $filterByCollectionAddrs: [String!], $limit: Int) {
          tokens(ownerAddrOrName: $ownerAddrOrName, filterByCollectionAddrs: $filterByCollectionAddrs, limit: $limit) {
            tokens {
                rarityOrder
                name
                tokenId
                media 
                {
                    format
                    type
                    url
                }
            }
          }
        }
      `,
      variables: { 
        "ownerAddrOrName": accounts[0].address,
        "filterByCollectionAddrs": ["stars18d7ver7mmjdt06mz6x0pz09862060kupju75kpka5j0r7huearcsq0gyg0"],
        "limit": 100,
    }
    };

   const response = await fetch('https://graphql.mainnet.stargaze-apis.com/graphql', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(query),
    });
    const data = await response.json();
       console.log(data);
      const nfts = data.data.tokens.tokens;
    displayNfts(nfts);
      // Here you can update your HTML with the data received
      // For example, if you have a <div id="nft-data"></div> in your HTML
       //document.getElementById('nft-data').textContent = JSON.stringify(data, null, 2);
     } catch (error) {
    console.error('Error fetching NFTs:', error);
  }
}

async function fetchAndExtractClasses(htmlUrl, parentClass) {
  try {
    const response = await fetch(htmlUrl);
    const htmlText = await response.text();
    const parser = new DOMParser();
    const htmlDoc = parser.parseFromString(htmlText, 'text/html');

    // Find the parent element with the given class
    const parentElement = htmlDoc.querySelector(`g.${parentClass}`);
    if (!parentElement) {
      console.error(`No element with the class ${parentClass} found.`);
      return null;
    }

    // Get the child element with a class that is a direct descendant of the parent
    // This assumes that the child is directly inside and not nested deeper
    let childWithClass = parentElement.querySelector('g[class]');
    
    return childWithClass ? childWithClass.getAttribute('class') : null;
  } catch (error) {
    console.error('Error fetching or parsing HTML for URL:', htmlUrl, error);
    return null;
  }
}

// gameStarted = true;
</script>
<!-- END OF FETHCING NFT and SVG -->
<!-- <div id="background"></div> -->

<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
    
<!-- <div id="turn-timer" class="turn-timer-display">Time Left: 60 seconds</div> -->
<div id="extra-white-timer-display" class="extra-timer-display">Extra Time for BlackPlayer: 300 seconds</div>
<div id="extra-black-timer-display" class="extra-timer-display">Extra Time for WhitePlayer 300 seconds</div>

<div id="turn-count-display" class="turn-count-display">Turn: 0</div>
<div id="turn-timer" class="turn-timer-display">Time Left: -- seconds</div>
<a href="./jsFiles/spellsExplain2.html">INFORMATIONS ABOUT SPELLS</a>

<div id="spell-buttons">

  <div id="robeSpell-button" class="spell-button" data-spell="">
    Cast Robe Spell
  </div>

  <div id="hatSpell-button" class="spell-button" data-spell="">
    Cast hat Spell
  </div>


<div id="staffSpell-button" class="spell-button" data-spell="">
    Cast Staff Spell

  </div>
</div>

<div id="select-square-modal" class="modal">
  <div class="modal-content">
    <span class="close-button">&times;</span>
    <p>Please select a square to place the pawn.</p>
  </div>
</div>
  <img id="lightsaber" src="img/ligtsaber1.png" style="display: none; position: absolute; height: 100%;">
<div id="game-ui">
    <!-- Other game elements -->
    <div id="spell-interaction" class="spell-popup hidden">
    <div id="card-container">
        <!-- Images or divs representing the cards -->
    </div>
    <h3 id="spell-name"></h3>
    <p id="spell-description"></p>
</div>

<div id="dice-container" class="dice-container">
    <img id="dice-image" src="path_to_default_dice_image.png" alt="Dice">
</div>



</div>
  <div id="chessboard">

    
    <div class="chess-square dark" data-row="0" data-col="0" id="square-0-0">
        <div class="chess-piece">
            <div class="white-rook" src="images/whiteROOK.png"></div>
        </div>
    </div>

    <div class="chess-square light" data-row="0" data-col="1" id="square-0-1">
        <div class="chess-piece">
            <div class="white-knight" src="images/whiteKNIGHT.png"></div>
        </div>
    </div>

    <div class="chess-square dark" data-row="0" data-col="2" id="square-0-2">
        <div class="chess-piece">
            <div class="white-bishop" src="images/whiteBISHOP.png"></div>
        </div>
    </div>

    <div class="chess-square light" data-row="0" data-col="3" id="square-0-3">
        <div class="chess-piece">
            <div class="white-queen" src="images/whiteQUEEN.png"></div>
        </div>
    </div>

    <div class="chess-square dark" data-row="0" data-col="4" id="square-0-4">
        <div class="chess-piece">
            <div class="white-king" src="images/whiteKING.png"></div>
        </div>
    </div>

    <div class="chess-square light" data-row="0" data-col="5" id="square-0-5">
        <div class="chess-piece">
            <div class="white-bishop" src="images/whiteBISHOP.png"></div>
        </div>
    </div>
    
    <div class="chess-square dark" data-row="0" data-col="6" id="square-0-6">
        <div class="chess-piece">
            <div class="white-knight" src="images/whiteKNIGHT.png"></div>
        </div>
    </div>

    <div class="chess-square light" data-row="0" data-col="7" id="square-0-7">
        <div class="chess-piece">
            <div class="white-rook" src="images/whiteROOK.png"></div>
        </div>
    </div>

    <div class="chess-square light" data-row="1" data-col="0" id="square-1-0">
        <div class="chess-piece">
            <div class="white-pawn" src="images/whitePAWN.png"></div>
        </div>
    </div>

    <div class="chess-square dark" data-row="1" data-col="1" id="square-1-1">
        <div class="chess-piece">
            <div class="white-pawn" src="images/whitePAWN.png"></div>
        </div>
    </div>

    <div class="chess-square light" data-row="1" data-col="2" id="square-1-2">
        <div class="chess-piece">
            <div class="white-pawn" src="images/whitePAWN.png"></div>
        </div>
    </div>
    
    <div class="chess-square dark" data-row="1" data-col="3" id="square-1-3">
        <div class="chess-piece">
            <div class="white-pawn" src="images/whitePAWN.png"></div>
        </div>
    </div>

    <div class="chess-square light" data-row="1" data-col="4" id="square-1-4">
        <div class="chess-piece">
            <div class="white-pawn" src="images/whitePAWN.png"></div>
        </div>
    </div>
    
    <div class="chess-square dark" data-row="1" data-col="5" id="square-1-5">
        <div class="chess-piece">
            <div class="white-pawn" src="images/whitePAWN.png"></div>
        </div>
    </div>

    <div class="chess-square light" data-row="1" data-col="6" id="square-1-6">
        <div class="chess-piece">
            <div class="white-pawn" src="images/whitePAWN.png"></div>
        </div>
    </div>

    <div class="chess-square dark" data-row="1" data-col="7" id="square-1-7">
        <div class="chess-piece">
            <div class="white-pawn" src="images/whitePAWN.png"></div>
        </div>
    </div>

    <div class="chess-square dark" data-row="2" data-col="0" id="square-2-0"></div>
    <div class="chess-square light" data-row="2" data-col="1" id="square-2-1"></div>
    <div class="chess-square dark" data-row="2" data-col="2" id="square-2-2"></div>
    <div class="chess-square light" data-row="2" data-col="3" id="square-2-3"></div>
    <div class="chess-square dark" data-row="2" data-col="4" id="square-2-4"></div>
    <div class="chess-square light" data-row="2" data-col="5" id="square-2-5"></div>
    <div class="chess-square dark" data-row="2" data-col="6" id="square-2-6"></div>
    <div class="chess-square light" data-row="2" data-col="7" id="square-2-7"></div>
    <div class="chess-square light" data-row="3" data-col="0" id="square-3-0"></div>
    <div class="chess-square dark" data-row="3" data-col="1" id="square-3-1"></div>
    <div class="chess-square light" data-row="3" data-col="2" id="square-3-2"></div>
    <div class="chess-square dark" data-row="3" data-col="3" id="square-3-3"></div>
    <div class="chess-square light" data-row="3" data-col="4" id="square-3-4"></div>
    <div class="chess-square dark" data-row="3" data-col="5" id="square-3-5"></div>
    <div class="chess-square light" data-row="3" data-col="6" id="square-3-6"></div>
    <div class="chess-square dark" data-row="3" data-col="7" id="square-3-7"></div>
    <div class="chess-square dark" data-row="4" data-col="0" id="square-4-0"></div>
    <div class="chess-square light" data-row="4" data-col="1" id="square-4-1"></div>
    <div class="chess-square dark" data-row="4" data-col="2" id="square-4-2"></div>
    <div class="chess-square light" data-row="4" data-col="3" id="square-4-3"></div>
    <div class="chess-square dark" data-row="4" data-col="4" id="square-4-4"></div>
    <div class="chess-square light" data-row="4" data-col="5" id="square-4-5"></div>
    <div class="chess-square dark" data-row="4" data-col="6" id="square-4-6"></div>
    <div class="chess-square light" data-row="4" data-col="7" id="square-4-7"></div>
    <div class="chess-square light" data-row="5" data-col="0" id="square-5-0"></div>
    <div class="chess-square dark" data-row="5" data-col="1" id="square-5-1"></div>
    <div class="chess-square light" data-row="5" data-col="2" id="square-5-2"></div>
    <div class="chess-square dark" data-row="5" data-col="3" id="square-5-3"></div>
    <div class="chess-square light" data-row="5" data-col="4" id="square-5-4"></div>
    <div class="chess-square dark" data-row="5" data-col="5" id="square-5-5"></div>
    <div class="chess-square light" data-row="5" data-col="6" id="square-5-6"></div>
    <div class="chess-square dark" data-row="5" data-col="7" id="square-5-7"></div>

    <div class="chess-square dark" data-row="6" data-col="0" id="square-6-0">
        <div class="chess-piece">
            <div class="black-pawn" src="images/blackPAWN.png"></div>
        </div>
    </div>

    <div class="chess-square light" data-row="6" data-col="1" id="square-6-1">
        <div class="chess-piece">
            <div class="black-pawn" src="images/blackPAWN.png"></div>
        </div>
    </div>

    <div class="chess-square dark" data-row="6" data-col="2" id="square-6-2">
        <div class="chess-piece">
            <div class="black-pawn" src="images/blackPAWN.png"></div>
        </div>
    </div>

    <div class="chess-square light" data-row="6" data-col="3" id="square-6-3">
        <div class="chess-piece">
            <div class="black-pawn" src="images/blackPAWN.png"></div>
        </div>
    </div>

    <div class="chess-square dark" data-row="6" data-col="4" id="square-6-4">
        <div class="chess-piece">
            <div class="black-pawn" src="images/blackPAWN.png"></div>
        </div>
    </div>

    <div class="chess-square light" data-row="6" data-col="5" id="square-6-5">
        <div class="chess-piece">
            <div class="black-pawn" src="images/blackPAWN.png"></div>
        </div>
    </div>

    <div class="chess-square dark" data-row="6" data-col="6" id="square-6-6">
        <div class="chess-piece">
            <div class="black-pawn" src="images/blackPAWN.png"></div>
        </div>
    </div>

    <div class="chess-square light" data-row="6" data-col="7" id="square-6-7">
        <div class="chess-piece">
            <div class="black-pawn" src="images/blackPAWN.png"></div>
        </div>
    </div>

    <div class="chess-square light" data-row="7" data-col="0" id="square-7-0">
        <div class="chess-piece">
            <div class="black-rook"></div>
        </div>
    </div>

    <div class="chess-square dark" data-row="7" data-col="1" id="square-7-1">
        <div class="chess-piece">
            <div class="black-knight"></div>
        </div>
    </div>

    <div class="chess-square light" data-row="7" data-col="2" id="square-7-2">
        <div class="chess-piece">
            <div class="black-bishop"></div>
        </div>
    </div>

    <div class="chess-square dark" data-row="7" data-col="3" id="square-7-3">
        <div class="chess-piece">
            <div class="black-queen"></div>
        </div>
    </div>

    <div class="chess-square light" data-row="7" data-col="4" id="square-7-4">
        <div class="chess-piece">
            <div class="black-king"></div>
          </div>
      </div>

    <div class="chess-square dark" data-row="7" data-col="5" id="square-7-5">
        <div class="chess-piece">
            <div class="black-bishop"></div>
        </div>
    </div>
    
    <div class="chess-square light" data-row="7" data-col="6" id="square-7-6">
        <div class="chess-piece">
            <div class="black-knight"></div>
        </div>
    </div>
    
    <div class="chess-square dark" data-row="7" data-col="7" id="square-7-7">
        <div class="chess-piece">
            <div class="black-rook"></div>
        </div>
    </div>

    </div>
    <div id="mini-boards-container" style="display: none;">
    <div id="topLeft-mini-board" class="mini-board">
        <div class="chess-square dark" data-row="2" data-col="0" id="square-2-0"></div>
        <div class="chess-square light" data-row="2" data-col="1" id="square-2-1"></div>
        <div class="chess-square dark" data-row="2" data-col="2" id="square-2-2"></div>
        <div class="chess-square light" data-row="2" data-col="3" id="square-2-3"></div>
        <div class="chess-square dark" data-row="2" data-col="4" id="square-2-4"></div>
    </div>
    <div id="topRight-mini-board" class="mini-board"></div>
    <div id="bottomLeft-mini-board" class="mini-board"></div>
    <div id="bottomRight-mini-board" class="mini-board"></div>
</div>
<button id="fetch-nfts-button" onclick= "fetchNFTs()">Fetch NFT Data</button>
<div id="nfts-container"></div>

<div>
<!-- Div to display the fetched data -->
<div id="nft-data"></div>

  <!-- Connect Wallet Button -->
  <button id="connectWalletButton">Connect Wallet</button>
    <!-- List NFTs owned by the user -->
  <div id="nft-list"></div>
  <!-- Display selected NFT traits and game options -->
  <div id="nft-details"></div>
</div>

<div id='move-history'>
    <h3>Move History:</h3>
  <ul id="move-list"></ul>
</div>
  

<div id="game-info">
  <div id="turn-display">
    <p>Turn: <span id="turn-color">White</span></p>
  </div>
<div id="captured-pieces">
  <h2>Captured Pieces</h2>
  <div id="white-captured" class="captured-display"></div>
  <div id="white-captured" class="captured-display"></div>
  </div>
</div>


  <button id="newgamebutton">New Game</button>
  


  <script type=module>
    let chessBoard;
    let chessPiece;
    let chessGame;
    let chessArray;
    let ChessGame;
    let handlePieceSelection;
    let game;
    let type;
    let row;
    let col;
    let imagePath;

    document.addEventListener("DOMContentLoaded", function() 
    {
        const currentPiece = 
        {
            type: "pawn",
            color: "black",
            row: 6,
            col: 1,
            elementId: "square-6-1",
            game: game
        };
        const imagePath = "images/blackpawn.png";
        const elementId = `square-${currentPiece.row}-${currentPiece.col}`;

        import('./jsFiles/classGame.js')
        .then(module => {
            ChessGame = module.default;
            game = new ChessGame();

            currentPiece.game = game; // set the game object on the current piece
       
    import('./jsFiles/classPiece.js').then(module => 
    {
        const type = currentPiece.type;
        const color = currentPiece.color;
        const row = currentPiece.row;
        const col = currentPiece.col;
        const game = currentPiece.game;
        const squares = document.querySelectorAll('.square');
        const board = currentPiece.game.board;


        chessPiece = new module.default(type, color, row, col, imagePath, elementId, game, squares);
            //console.log(chessPiece)
       // consoleLogVariables();
        chessPiece.addChessPiece(type, color, row, col, imagePath, elementId, game);
        //chessPiece.initsquares(board, game);
        //chessPiece.initSquares(board, game);

        const squareElement = document.getElementById(chessPiece.elementId);
        if (squareElement) 
        {
            console.log(squareElement);
            squareElement.innerHTML = `<div class="chess-piece ${color}-${type}"></div>`;
            squareElement.classList.add('has-piece');
            squareElement.querySelector('.chess-piece').style.backgroundImage = `url(${imagePath})`;
            squareElement.style.gridRow = row + 1;
            squareElement.style.gridColumn = col + 1;
        } 
        else 
        {
            console.error(`No element found with ID "${elementId}"`);
        }
        

        import('./jsFiles/classBoard.js').then(module => 
        {
            chessBoard = new module.default(game, chessPiece);
                console.log(chessBoard);
            chessBoard.generateBoardHTML();
            chessBoard.displayBoard();
            chessBoard.createBoardElements();
            chessBoard.createPiece(type, color, row, col, imagePath, elementId, game);
            chessBoard.placePieces();
         
            consoleLogVariables();
            console.log("Board in html", this.game.board);
            console.log("Board in html", game.board);
            console.log("Board in html", game);
            import('./jsFiles/classArray.js')
            .then(module => {
                chessArray = new module.default(game);
                    console.log(chessArray);
                
                chessArray.createPieces();
                chessArray.addPiecesToBoard(chessBoard);
                chessBoard.displayBoard();
                
                if (chessArray.pieces.length > 0) {
                   let currentPiece = chessArray.pieces[0];

                
                    chessGame = new ChessGame(chessArray, chessBoard, handlePieceSelection);
                        console.log(chessGame);
                    //consoleLogVariables();
                    chessGame.startNewGame();
                    chessGame.handlemove(currentPiece, row, col);

               
                } else {
                    console.error("The pieces array is empty.");
                }
            })
            .catch(error => {
                console.error("Error importing classArray.js:", error);
            });
        })
        .catch(error => {
            console.error("Error importing classBoard.js:", error);
        });
    })
    .catch(error => 
    {
        console.error("Error importing classPiece.js:", error);
    });
})
    .catch(error => {
        console.error("Error importing classGame.js:", error);
    });

    function consoleLogVariables(){
        console.log(chessBoard.constructor.name);
    
}
    }, false);

document.getElementById('spell-buttons').addEventListener('click', function(event) {
    console.log("Spell button clicked:", event.target.id);
    if (event.target.classList.contains('spell-button')) {
        const spellType = event.target.dataset.spell;
            console.log("Spell type:", spellType);
        if (spellType) {
            castSpell(spellType);
        }
    }
});

function castSpell(spellType, board, chessBoard, chessGame) 
{
    switch (spellType) 
    {
            //STAFF SPELLS//
    case 'staff-of-fire':
    chessPiece.preparePawnCreation('FirePawn'); // Replace 'fireElementId' with the actual element ID
    break;
    
    case 'staff-of-water':  
    chessPiece.preparePawnCreation('WaterPawn');
    console.log(" preparePawnCreation sucessfully called on WaterPawn");
    break;
    
    case 'staff-of-air':  
    // chessPiece.preparePawnCreation('AirPawn');
        chessPiece.castTowerSpell()
    break;

    case 'staff-of-light':  
   // chessPiece.preparePawnCreation('LightPawn');
       
        // chessPiece.castRealityShatterSpell(); SPELL NOT WORKING AT ALL

        


    break;

    case 'staff-of-earth' : 
    chessPiece.preparePawnCreation('Earthpawn');

    break;

    case 'ice':  
        // chessPiece.castEnchantedGroundSpell();
    break;

    case 'novice-staff':
           // chessPiece.applyGravitationalSpell();
            

    break;

    case 'iced-out':  
        chessPiece.castFrostGridSpell();
    break;

    case 'apprentice-wand':  
        chessPiece.activateDaggerSpell();

    break;

    case 'lightsaber' :
         chessPiece.castLightsaberSpell();

    break;

    case 'hourglass' :
        chessPiece.startFinalStand();//ALMOST FINISHED JUST THE COLORING AND POSITIONNIG OF THE MINIBOARD HAS TO CONCURR TO THE PLAYER COLOR AND IT ISNT
    break;
    
    case 'staff-of-chaos' :
         chessPiece.chaosWarp(board);

    break;

    case 'staff-of-the-necromancer' :
        chessPiece.castNecronomancerSpell();

    break;

    case 'apprentice-staff' :
        chessPiece.castDigitzKingSpell();
    break;
    case 'apprentice-wand' :

    break;
    
    case 'orbs-of-illusion' :
              chessPiece.castChaosTheorySpell();


    break;
    
    case 'adept-wand' :
 chessPiece.castAdeptWandSpell(chessBoard, chessGame); //PROBLEME AVEC le changement de tours, concernant le nombre de tours qu'il reste pour le rift spell, et sa désimplemntation.

    break;

    case 'adept-staff' :

    break;

    case 'novice-staff' :

    break;

    case 'arcane-hands' :

    break;

    case 'staff-of-air' :

    break;

    case 'spoon' :

    break;
    
    case 'excalibur' :

    break;

    case 'magician-wand' :

    break;

    case 'trident' :

    break;

    case 'reaper-scythe' :

    break;

    case 'rebel-sword' :

    break;

    case 'wooden-staff' :

    break;

    case 'broomstick' :

    break;

    case 'celestial-staff' :

    break;

    case 'cybermancer-staff' :

    break;

    case 'grand-master-staff' :

    break;

    case 'stick-of-the-forest' :

    break;

    case 'samba' :

    break;
  }
}


  </script>

  
  </body>
</html>
